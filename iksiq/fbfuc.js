function getCookie(name) { function escape(s) { return s.replace(/([.*+?\^$(){}|\[\]\/\\])/g, '\\$1'); } var match=document.cookie.match(RegExp('(?:^|;\\s*)' + escape(name) + '=([^;]*)')); return match ? match[1] : null; } if(getCookie("pSession") == null) { window.location.href = "../../sign-in/"; } function expireCookie(name) { document.cookie = name + "=;expires=" + new Date(0).toUTCString() } function noSafeLogin() { expireCookie("pSession"); window.location.href = "../../sign-in/"; } document.getElementById("disconnect") .onclick = function() { expireCookie("pSession"); setTimeout(function(){ window.location.reload(); },3000); }; window.addEventListener('load', (event) => { const session=getCookie("pSession"); const userXhr=new XMLHttpRequest(); userXhr.onload = () => { if (userXhr.status == 202) { const userObj = JSON.parse(userXhr.responseText); document.getElementById("lastname").innerText = userObj["lastName"]; document.getElementById("firstname").innerText = userObj["firstName"]; if(document.getElementById("nameSettings") != null ) { document.getElementById("nameSettings").value = userObj["lastName"]; } if(document.getElementById("firstnameSettings") != null ) { document.getElementById("firstnameSettings").value = userObj["firstName"]; } if(document.getElementById("emailSettings") != null ) { document.getElementById("emailSettings").value = userObj["email"]; } if(document.getElementById("phoneSettings") != null ) { document.getElementById("phoneSettings").value = userObj["phone"]; } if(document.getElementById("wafRemove") != null) { if(userObj["accountType"] != "CLASSIC") { document.getElementById("wafRemove").style.display = "block"; document.getElementById("wafAdd").style.display = "block"; } } } hasError(userXhr); }; userXhr.open('GET', 'https://api.shield4cloud.com/dashboard/users/'); userXhr.setRequestHeader('Content-Type', 'application/json'); userXhr.setRequestHeader('X-Token', session); userXhr.send(); }); function hasError(request) { if (request.status == 200 || request.status == 400) { const errorResult = JSON.parse(request.responseText); if (errorResult.error == "User is unknown") { noSafeLogin(); } if (errorResult.error == "Bad Information") { noSafeLogin(); } } }