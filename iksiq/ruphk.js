window.addEventListener('load', (event) => { const session=getCookie("pSession"); document.getElementById("userUpdate") .onclick = function() { const userRequestUpdate=new XMLHttpRequest(); userRequestUpdate.onload = () => { const status = userRequestUpdate.status; if (status == 202) { const userResult = JSON.parse(userRequestUpdate.responseText); alertSuccess("Votre paramétres ont été modifier"); window.setTimeout(function(){ window.location.reload(); }, 3000); } else { hasError(userRequestUpdate); } }; const json = {"email": document.getElementById("emailSettings").value, "lastName": document.getElementById("nameSettings").value, "firstName": document.getElementById("firstnameSettings").value, "password": document.getElementById("passwordSettings").value, "phone": document.getElementById("phoneSettings").value}; userRequestUpdate.open('POST', 'https://api.shield4cloud.com/dashboard/users/update/'); userRequestUpdate.setRequestHeader('Content-Type', "application/json"); userRequestUpdate.setRequestHeader('X-Token', session); userRequestUpdate.send(JSON.stringify(json)); }; }); function hasError(request) { if (request.status == 200 || request.status == 400) { const errorResult = JSON.parse(request.responseText); if(errorResult.error == "Bad Password") { alertError("Mot de passe à plus de 32 caractère"); } if(errorResult.error == "Bad lastName") { alertError("Nom de famille est invalide"); } if(errorResult.error == "lastName Big Size") { alertError("Nom de famille à plus de 64 caractère"); } if(errorResult.error == "Bad firstName") { alertError("Prénom est invalide"); } if(errorResult.error == "firstName Big Size") { alertError("Votre nom à plus de 64 caractère"); } if(errorResult.error == "Bad phone") { alertError("Téléphone est invalide"); } if(errorResult.error == "Phone Big Size") { alertError("Votre Téléphone à plus de 18 caractère"); } if (errorResult.error == "User is unknown") { noSafeLogin(); } if (errorResult.error == "Bad Information") { noSafeLogin(); } } } function alertError(text) { Swal.fire({ icon: 'error', title: 'Oops...', text: text, showConfirmButton: true, timer: 5000 }); }; function alertSuccess(text) { Swal.fire({ icon: 'success', title: 'Good Job!', text: text, showConfirmButton: true, timer: 5000 }); };