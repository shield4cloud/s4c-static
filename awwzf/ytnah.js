document.getElementById('sendLogin') .onclick = function () { const email=document.getElementById("emailLogin") .value; const password=document.getElementById("passwordLogin") .value; if(empty(email) || empty(password)) { alertError("Saisir votre email et votre mot de passe."); return; } if(!isValidateEmail(email)) { alertError("Saisir une addresse email correct !"); return; } const xhr=new XMLHttpRequest(); xhr.onload = () => { if (xhr.status == 202) { const loginResult = JSON.parse(xhr.responseText); const tokenId = loginResult.id; setCookie("pSession",tokenId); window.location.href = "../dashboard/accueil/"; } if(xhr.status == 400) { alertError("Votre demande d'authentification est impossible !"); } if (xhr.status == 200) { const errorResult = JSON.parse(xhr.responseText); if(errorResult.error == "Password Big Size") { alertError("Votre mot de passe est incorrect !"); } if(errorResult.error == "Incorrect Password") { alertError("Votre mot de passe est incorrect !"); } if(errorResult.error == "Password is not valide") { alertError("Votre mot de passe est incorrect !"); } if(errorResult.error == "Email is not valide") { alertError("Ce compte n'existe pas !"); } if(errorResult.error == "User is unknown") { alertError("Ce compte n'existe pas !"); } } }; const json = {"email": email,"password": password}; xhr.open('POST', 'https://api.shield4cloud.com/dashboard/users/login/'); xhr.setRequestHeader('Content-Type', 'application/json'); xhr.send(JSON.stringify(json)); }; function alertError(text) { Swal.fire({ icon: 'error', title: 'Oops...', text: text, showConfirmButton: true, timer: 5000 }); }; function isValidateEmail(inputText) { var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/; if(inputText.match(mailformat)) { return true; } else { return false; } } function empty(string) { if(string == null) { return true; } if(string == "") { return true; } return false; } function setCookie(name,value) { var expires = ""; var date = new Date(); date.setTime(date.getTime() + (30*60*1000)); expires = "; expires=" + date.toUTCString(); document.cookie = name + "=" + (value || "") + expires + "; path=/"; }