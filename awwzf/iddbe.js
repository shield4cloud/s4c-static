window.addEventListener('load', (event) => { const session=getCookie("pSession"); loadCompany(session); document.getElementById("back") .onclick = function() { window.location.reload(); }; }); function createPentest(session, uuidCompany, nameCompany) { document.getElementById(uuidCompany) .onclick = function() { loadPentest(session, uuidCompany, nameCompany); }; } function hasError(request) { if (request.status == 200 || request.status == 400) { const errorResult=JSON.parse(request.responseText); if (errorResult.error == "Empty Company" || errorResult.error == "Company is remove") { alertError("Vous n'avez pas d'entreprise !"); } if (errorResult.error == "User is unknown") { noSafeLogin(); } if (errorResult.error == "Bad Information") { noSafeLogin(); } } } function alertError(text) { Swal.fire({ icon: 'error', title: 'Oops...', text: text, showConfirmButton: true, timer: 5000 }); }; function loadCompany(session) { const companyRequest=new XMLHttpRequest(); companyRequest.onload = () => { const status = companyRequest.status; if (status == 202) { const companyListResult = JSON.parse(companyRequest.responseText); const companyNumber = companyListResult.length; document.getElementById('companyCount').textContent = companyNumber; for (var i = 0; i < companyListResult.length; i++) { var company=companyListResult[i]; var divCardLg=document.createElement("div"); divCardLg.className = "card-lg"; var divCardLeft=document.createElement("div"); divCardLeft.className = "left"; var imgLeft=document.createElement("img"); if(company["logo"] == null) { imgLeft.src = "https://logos-marques.com/wp-content/uploads/2021/03/Apple-logo-500x333.png"; } else { imgLeft.src = company["logo"]; } var divCardRight=document.createElement("div"); divCardRight.className = "right"; var spanRight=document.createElement("span"); spanRight.innerText = company["name"]; var aCard=document.createElement("a"); aCard.innerText = "Voir vos pentests"; aCard.id = company["uniqueId"]; divCardRight.appendChild(spanRight); divCardLg.appendChild(divCardRight); divCardLeft.appendChild(imgLeft); divCardLg.appendChild(divCardLeft); divCardLg.appendChild(aCard); document.getElementById("pentestsData") .appendChild(divCardLg); createPentest(session, company["uniqueId"], company["name"]); } } else { hasError(companyRequest); } }; companyRequest.open('GET', '../../api/dash/companys/' + session); companyRequest.setRequestHeader('Content-Type', 'application/json'); companyRequest.send(); } function loadPentest(session, uuidCompany, nameCompany) { const wafRequest=new XMLHttpRequest(); wafRequest.onload = () => { const status = wafRequest.status; if (status == 202) { const pentestListResult = JSON.parse(wafRequest.responseText); document.getElementById("companyName").innerText = nameCompany; document.getElementById("companyNameTwo").innerText = nameCompany; document.getElementById("pentests").style.display = "none"; document.getElementById("pentestsData").style.display = "none"; document.getElementById("pentest").style.display = "block"; for (var i = 0; i < pentestListResult.length; i++) { var pentest = pentestListResult[i]; var divCardPentest = document.createElement("div"); divCardPentest.className = "card-pentest"; var divHeaderCp = document.createElement("div"); divHeaderCp.className = "header-cp"; var imgHeaderCp = document.createElement("img"); imgHeaderCp.src = "../../gwvoo/laiem.svg"; var spanHeaderCp = document.createElement("span"); spanHeaderCp.innerText = "Pentest #" + (i + 1); var divFooterCp = document.createElement("div"); divFooterCp.className = "footer-cp"; var spanFooterCpCalendar = document.createElement("span"); spanFooterCpCalendar.className = "calendar"; spanFooterCpCalendar.innerText = pentest["timestamp"]; var spanFooterCpName = document.createElement("span"); spanFooterCpName.className = "name-cp"; spanFooterCpName.innerText = pentest["author"]; divCardPentest.appendChild(divHeaderCp); divHeaderCp.appendChild(imgHeaderCp); divHeaderCp.appendChild(spanHeaderCp); divCardPentest.appendChild(divFooterCp); divFooterCp.appendChild(spanFooterCpCalendar); divFooterCp.appendChild(spanFooterCpName); document.getElementById("pentestData") .appendChild(divCardPentest); } } else { hasError(wafRequest); } }; wafRequest.open('GET', '../../api/dash/pentests/' + uuidCompany + "/all"); wafRequest.setRequestHeader('X-Token', session); wafRequest.send(); }